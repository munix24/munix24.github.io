<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoL Champion Fight Simulation</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        .container {
            text-align: center;
            display: flex;
            justify-content: space-between;
            width: 95%; 
        }
        .column {
            flex: 1;
            margin: 0 10px;
            text-align: left;
        }
        .fight {
            flex: 3;
            border: 1px solid black;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        .fight-top, .fight-bottom {
            flex: 1;
            overflow-y: auto;
        }
        .fight-top {
            border-bottom: 1px solid black;
            height: 75%; 
        }
        .fight-bottom {
            border-bottom: 1px solid black;
            height: 25%; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="column" style="text-align: left;">
            <h1>Champion 1</h1>

            <label for="champion1">Select Champion:</label>
            <select id="champion1">
                <!-- Champions will be populated dynamically with JavaScript -->
            </select>

            <div id="championStats1"></div>
        </div>

        <div class="fight">
            <div class="fight-top">
                <h1>Fight Simulation</h1>
            </div>
            <div class="fight-bottom" id="fightActions"></div>
        </div>

        <div class="column" style="text-align: right;">
            <h1>Champion 2</h1>

            <label for="champion2">Select Champion:</label>
            <select id="champion2">
                <!-- Champions will be populated dynamically with JavaScript -->
            </select>

            <div id="championStats2"></div>
        </div>
    </div>

    <script src="Champ.js"></script>
    <script src="champion.js"></script>
    <script>
        // Function to populate the dropdowns with champions
        async function populateChampions() {
            const championData = window.json.data; // Assuming champion data is in a global variable
            const champion1Select = document.getElementById('champion1');
            const champion2Select = document.getElementById('champion2');

            // Populate options for both dropdowns
            for (const championName in championData) {
                const option1 = document.createElement('option');
                option1.value = championName;
                option1.textContent = championName;
                const option2 = option1.cloneNode(true);
                champion1Select.appendChild(option1);
                champion2Select.appendChild(option2);
            }

            // Add event listeners to both selects to display stats and simulate fight
            champion1Select.addEventListener('change', displayStatsAndFight);
            champion2Select.addEventListener('change', displayStatsAndFight);
        }

        // Function to display the stats of selected champions and simulate fight
        async function displayStatsAndFight() {
            const champion1Name = document.getElementById('champion1').value;
            const champion2Name = document.getElementById('champion2').value;
            const level = 1; // You can modify this to set the level dynamically if needed

            const champion1 = new Champ(champion1Name, level);
            const champion2 = new Champ(champion2Name, level);

            // Display champion stats
            const championStatsDiv1 = document.getElementById('championStats1');
            championStatsDiv1.innerHTML = `
                <h2>${champion1Name} stats:</h2>
                <pre>${JSON.stringify(champion1.stats, null, 2)}</pre>
            `;

            const championStatsDiv2 = document.getElementById('championStats2');
            championStatsDiv2.innerHTML = `
                <h2>${champion2Name} stats:</h2>
                <pre>${JSON.stringify(champion2.stats, null, 2)}</pre>
            `;

            // Simulate fight
            const fightActionsDiv = document.getElementById('fightActions');
            fightActionsDiv.innerHTML = ''; // Clear previous fight actions

            const { winner, remainingHp } = await simulateFight(champion1, champion2, fightActionsDiv, true);
			fightActionsDiv.innerHTML += `<p>${winner.name} wins with ${remainingHp.toFixed(2)} HP remaining!</p>`;
        }

		// Function to simulate the fight between two champions
		async function simulateFight(champion1, champion2, fightActionsDiv, instant = true) {
			return new Promise(resolve => {
				const attackQueue = [{ time: 0, attacker: champion1, attacked: champion2 }, { time: 0, attacker: champion2, attacked: champion1 }];
				attackQueue.sort((a, b) => a.time - b.time);

				if (instant) {
					while (attackQueue.length && !champion1.isDefeated() && !champion2.isDefeated()) {
						const { time, attacker, attacked } = attackQueue.shift();
						attacker.attack(attacked);
						fightActionsDiv.innerHTML += `<p>${time.toFixed(2)}s: ${attacked.name} took ${attacker.attackdamage} damage. ${attacked.name}'s HP: ${attacked.hp}</p>`;
						attackQueue.push({ time: attacker.attack_cd, attacker, attacked });
						attackQueue.sort((a, b) => a.time - b.time);
					}
					resolve({
						winner: champion1.isDefeated() ? champion2 : champion1,
						remainingHp: champion1.isDefeated() ? champion2.hp : champion1.hp
					});
				} else {
					const interval = setInterval(() => {
						if (!attackQueue.length || champion1.isDefeated() || champion2.isDefeated()) {
							clearInterval(interval);
							resolve({
								winner: champion1.isDefeated() ? champion2 : champion1,
								remainingHp: champion1.isDefeated() ? champion2.hp : champion1.hp
							});
						} else {
							const { time, attacker, attacked } = attackQueue.shift();
							attacker.attack(attacked);
							fightActionsDiv.innerHTML += `<p>${time.toFixed(2)}s: ${attacked.name} took ${attacker.attackdamage} damage. ${attacked.name}'s HP: ${attacked.hp}</p>`;
							attackQueue.push({ time: attacker.attack_cd, attacker, attacked });
							attackQueue.sort((a, b) => a.time - b.time);
						}
					}, 1000);
				}
			});
		}

        // Populate the dropdowns and simulate the fight when the page loads
        window.onload = populateChampions;
    </script>
</body>
</html>
